# Руководство по использованию OCR режима

## Обзор

OCR режим позволяет извлекать встроенные субтитры из видеопотока с использованием технологии оптического распознавания символов. Это особенно полезно для видео, где субтитры уже встроены в изображение и не могут быть извлечены как отдельный поток.

## Установка зависимостей

### 1. Установка Python пакетов

```bash
pip install -r requirements_ocr.txt
```

Или установите пакеты по отдельности:

```bash
pip install opencv-python>=4.8.0
pip install pytesseract>=0.3.10
pip install easyocr>=1.7.0
```

### 2. Установка Tesseract OCR движка

#### Windows
1. Скачайте установщик с [официального сайта](https://github.com/UB-Mannheim/tesseract/wiki)
2. Установите Tesseract OCR
3. Добавьте путь к исполняемому файлу в переменную PATH или укажите путь в коде

#### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install tesseract-ocr
```

#### macOS
```bash
brew install tesseract
```

### 3. Установка языковых пакетов

Для поддержки различных языков установите соответствующие языковые пакеты:

#### Windows
- `tesseract-ocr-eng` - английский
- `tesseract-ocr-rus` - русский
- `tesseract-ocr-deu` - немецкий
- `tesseract-ocr-fra` - французский
- `tesseract-ocr-spa` - испанский
- `tesseract-ocr-ita` - итальянский

#### Ubuntu/Debian
```bash
sudo apt-get install tesseract-ocr-eng tesseract-ocr-rus tesseract-ocr-deu
```

#### macOS
```bash
brew install tesseract-lang
```

## Использование OCR режима

### 1. Активация OCR режима

1. В главном окне приложения найдите секцию "Режим обработки"
2. Выберите "OCR извлечение субтитров"
3. Появится панель "Настройки OCR"

### 2. Настройка OCR параметров

#### OCR движок
- **Tesseract**: Более точный, но медленнее
- **EasyOCR**: Быстрее, но может быть менее точным

#### OCR язык
Выберите язык субтитров:
- `eng` - английский
- `rus` - русский
- `deu` - немецкий
- `fra` - французский
- `spa` - испанский
- `ita` - итальянский
- `ukr` - украинский
- `pol` - польский

#### Область субтитров
Укажите координаты области, где находятся субтитры:
- **X, Y**: Левый верхний угол области
- **W, H**: Ширина и высота области

### 3. Автоматическое определение области

1. Добавьте видео в очередь задач
2. Нажмите кнопку "Автоопределение" в настройках OCR
3. Система автоматически проанализирует первый кадр и определит область субтитров

### 4. Запуск обработки

1. Добавьте видео файлы в очередь
2. Настройте параметры OCR
3. Нажмите "Начать обработку"
4. Дождитесь завершения обработки

## Рекомендации по качеству

### Подготовка видео

1. **Качество изображения**: Чем выше разрешение, тем лучше распознавание
2. **Контрастность**: Субтитры должны быть четко видны на фоне
3. **Размер шрифта**: Крупные субтитры распознаются лучше
4. **Стабильность**: Субтитры не должны "прыгать" по экрану

### Настройка области субтитров

1. **Точность**: Укажите точные координаты области субтитров
2. **Отступы**: Добавьте небольшие отступы вокруг текста
3. **Тестирование**: Протестируйте на нескольких кадрах

### Выбор OCR движка

- **Tesseract**: Используйте для высококачественных видео с четким текстом
- **EasyOCR**: Используйте для быстрой обработки или видео среднего качества

## Ограничения и известные проблемы

### Ограничения

1. **Качество видео**: Низкое качество значительно снижает точность
2. **Сложные шрифты**: Декоративные или нестандартные шрифты могут не распознаваться
3. **Цветной текст**: OCR лучше работает с монохромным текстом
4. **Наклонный текст**: Текст под углом распознается хуже

### Известные проблемы

1. **Медленная обработка**: OCR требует значительных вычислительных ресурсов
2. **Ложные срабатывания**: Могут распознаваться артефакты как текст
3. **Пропуск текста**: Быстро мелькающий текст может быть пропущен

## Плагины для OCR

### OCR Subtitle Extractor Plugin

Автоматически настраивает OCR режим и оптимальные параметры:

1. Загрузите плагин через "Загрузить плагин"
2. Плагин автоматически переключит в OCR режим
3. Настроит оптимальные параметры
4. Попытается автоматически определить область субтитров

## Отладка и решение проблем

### Проверка установки

```python
# Проверка OpenCV
import cv2
print("OpenCV версия:", cv2.__version__)

# Проверка Tesseract
import pytesseract
print("Tesseract версия:", pytesseract.get_tesseract_version())

# Проверка EasyOCR
import easyocr
print("EasyOCR доступен")
```

### Типичные ошибки

1. **"Tesseract не найден"**: Установите Tesseract OCR и добавьте в PATH
2. **"OpenCV не установлен"**: Установите opencv-python
3. **"Язык не поддерживается"**: Установите соответствующий языковой пакет
4. **Низкая точность**: Проверьте качество видео и настройки области

### Логи и отладка

Все операции OCR записываются в журнал событий приложения. Проверьте логи для диагностики проблем.

## Производительность

### Оптимизация скорости

1. **Уменьшите разрешение**: Обрабатывайте видео в меньшем разрешении
2. **Ограничьте область**: Укажите точную область субтитров
3. **Используйте EasyOCR**: Для более быстрой обработки
4. **Увеличьте интервал кадров**: Обрабатывайте не каждый кадр

### Требования к системе

- **CPU**: Многоядерный процессор рекомендуется
- **RAM**: Минимум 4GB, рекомендуется 8GB+
- **GPU**: Не используется в текущей реализации

## Заключение

OCR режим предоставляет мощный инструмент для извлечения встроенных субтитров из видео. При правильной настройке и качественном исходном материале можно достичь высокой точности распознавания текста.
